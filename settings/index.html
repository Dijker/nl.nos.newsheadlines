<!doctype html>
<html>
    <head>

    </head>
    <body>

        <h1>News headlines (<i>nl.webchitect.newsheadlines</i>)</h1>
        <p>On this page, you will be able to adjust the settings of the News headlines app.</p>

        <fieldset>
            <legend>Settings</legend>

            <div class="field row">
                <label for="test">Amount of news articles Homey curates (min 1, max 8)</label>
                <input id="numberOfNewsArticles" type="number" value="" min="1" max="8" />
            </div>

        </fieldset>

        <button class="right" id="saver" onclick="save()">Save changes</button>

        <script type="text/javascript">
        function onHomeyReady(){
            Homey.get('numberOfNewsArticles', function(err,data) {
                document.getElementById('numberOfNewsArticles').value = data;
            });
            Homey.ready();
        }
        function save() {
            // Retrieve DOM elements
            var button = document.getElementById('saver'),
                newsBlock = document.getElementById('numberOfNewsArticles');
            // Set both disabled onSave
            button.disabled = true;
            newsBlock.disabled = true;
            // Define update status
            var update = "true";
            // Check if news articles exceed limit; change status if the case
            if (newsBlock.value > 8) { update = "trueHigh" };
            if (newsBlock.value < 1) { update = "trueLow" };
            // Validate the number of news articles and change if necessary
            var validatedNewsArticles = (newsBlock.value > 8 ? 8 : (newsBlock.value < 1 ? 1 : newsBlock.value));
            document.getElementById('numberOfNewsArticles').value=validatedNewsArticles;
            // Show message in the save button
            if(update === "true") {
                button.innerHTML = "Changes saved";
            }
            else if(update === "trueHigh") {
                button.innerHTML = "Changes saved, but selected no. of articles was reduced to maximum value of 8";
            }
            else {
                button.innerHTML = "Changes saved, but selected no. of articles was set to minimum value of 1"
            }
            // Change the settings in Homey.
            Homey.set('numberOfNewsArticles', validatedNewsArticles);
            // Return to edit mode after 3.5 seconds
            setTimeout(function() {
                button.disabled = false;
                newsBlock.disabled = false;
                button.innerHTML = "Save changes"
            },3500);
        }
        </script>

    </body>
</html>